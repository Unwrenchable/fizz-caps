<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PIP-BOY 3000 Mk IV • ATOMIC FIZZ • VAULT 77</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#001100">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<style>
  body,html{margin:0;padding:0;height:100%;background:#000;color:#0f0;font-family:'VT323',monospace;overflow:hidden}
  #map{position:absolute;top:0;left:0,width:100%;height:100%;filter:brightness(1.1) contrast(1.4);}
  #overlay{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;
    background:radial-gradient(circle at center,rgba(0,50,0,0.3),rgba(0,20,0,0.8));
    box-shadow:inset 0 0 100px #0f0,inset 0 0 200px #000;
  }
  #crt::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;
    background:repeating-linear-gradient(0deg,rgba(0,255,0,0.05),rgba(0,255,0,0.05) 2px,transparent 2px,transparent 4px);
    pointer-events:none;z-index:9999;animation:scan 8s linear infinite;
  }
  @keyframes scan{0%{transform:translateY(-100%)}100%{transform:translateY(100%)}}
  .pipboy-ui{position:absolute;top:10px;left:10px;right:10px;bottom:10px;pointer-events:none;z-index:1000}
  .top-bar{position:absolute;top:15px;left:50%;transform:translateX(-50%);background:rgba(0,20,0,0.9);padding:5px 20px;border:3px solid #0f0;border-radius:15px;font-size:2.2rem;pointer-events:auto}
  .bottom-bar{position:absolute;bottom:20px;left:0;right:0;display:flex;justify-content:center;gap:30px;pointer-events:auto}
  .tab{background:rgba(0,30,0,0.9);padding:15px 40px;border:4px solid #0f0;border-radius:20px;font-size:2.5rem;cursor:pointer;transition:0.3s}
  .tab.active,.tab:hover{background:#003300;border-color:#0ff;box-shadow:0 0 30px #0f0}
  .status{position:absolute;top:80px;left:20px;right:20px;display:flex;justify-content:space-between;font-size:2rem;background:rgba(0,20,0,0.7);padding:10px 20px;border:3px solid #0f0;border-radius:10px}
  .bar{width:300px;height:30px;background:#000;border:2px solid #0f0;position:relative;overflow:hidden}
  .bar > div{height:100%;background:linear-gradient(to right,#0f0,#00ff00);transition:width 0.5s}
  #radVignette{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(255,0,0,0.3);opacity:0;transition:opacity 1s;pointer-events:none}
  #radVignette.active{opacity:1}
  #lootOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,50,0,0.98);display:none;align-items:center;justify-content:center;z-index:9999;flex-direction:column;color:#0f0;font-size:4rem;text-align:center;cursor:pointer}
  #statsOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,30,0,0.98);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:9998;color:#0f0;font-size:2.5rem;padding:20px;overflow-y:auto}
  .stat{display:flex;gap:20px;align-items:center;margin:15px 0;font-size:3rem}
  .plus-btn{background:#0f0;color:#000;padding:5px 20px;margin-left:20px;cursor:pointer;border-radius:10px}
  .perk{margin:20px;padding:20px;background:rgba(0,100,0,0.5);border:2px solid #0f0;border-radius:15px;cursor:pointer;width:80%}
</style>
</head>
<body>
<div id="map"></div>
<div id="overlay"><div id="crt"></div></div>
<div id="radVignette"></div>

<div class="pipboy-ui">
  <div class="top-bar">ATOMIC FIZZ • VAULT 77 • WASTELAND SURVIVOR</div>
  
  <div class="status">
    <div>HP <div class="bar" id="hpBar"><div style="width:100%"></div></div> <span id="hpText">100/100</span></div>
    <div>RADS <div class="bar" id="radsBar"><div style="width:0%"></div></div> <span id="radsText">0</span></div>
    <div>CAPS: $<span id="capsText">0</span></div>
  </div>

  <div class="bottom-bar">
    <div class="tab active" onclick="showTab('map')">MAP</div>
    <div class="tab" onclick="showTab('inv')">INV</div>
    <div class="tab" onclick="showTab('stats')">STAT</div>
  </div>
</div>

<div id="lootOverlay" onclick="this.style.display='none'">
  <div id="lootMessage">LOOT ACQUIRED</div>
</div>

<div id="statsOverlay">
  <div id="statGrid"></div>
  <div id="perkList"></div>
  <button style="margin-top:40px;font-size:3rem;padding:20px 50px;background:#0f0;color:#000;border-radius:20px;cursor:pointer" onclick="document.getElementById('statsOverlay').style.display='none'">CLOSE</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// ████████████████████████████████████████████ FALLOUT LOCATIONS + RADS ████████████████████████████████████████████
const locations = [
  {n:"Goodsprings Saloon",lat:35.8324,lng:-115.4320,lvl:1,rarity:"common"},
  {n:"Primm Rollercoaster",lat:35.6145,lng:-115.3845,lvl:2,rarity:"common"},
  {n:"Novac Motel",lat:35.0525,lng:-114.8247,lvl:5,rarity:"rare"},
  {n:"Hoover Dam",lat:36.016,lng:-114.738,lvl:12,rarity:"epic"},
  {n:"The Strip Gate",lat:36.1147,lng:-115.1728,lvl:15,rarity:"epic"},
  {n:"Lucky 38",lat:36.147,lng:-115.156,lvl:18,rarity:"epic"},
  {n:"Black Mountain",lat:35.9310,lng:-115.0440,lvl:20,rarity:"epic"},
  {n:"Area 51 Gate",lat:37.2431,lng:-115.7930,lvl:45,rarity:"legendary"},
  {n:"Vault 77 (Secret)",lat:36.170,lng:-115.140,lvl:77,rarity:"legendary"},
  {n:"Chernobyl Pripyat",lat:51.389,lng:30.099,lvl:99,rarity:"legendary"},
  {n:"Fukushima Daiichi",lat:37.421,lng:141.032,lvl:99,rarity:"legendary"},
  {n:"Vault 34",lat:36.1750,lng:-114.7500,lvl:20,rarity:"epic"},
  {n:"Jacobstown",lat:36.3000,lng:-115.6500,lvl:22,rarity:"rare"},
  {n:"Searchlight Church",lat:35.46434,lng:-114.91844,lvl:10,rarity:"rare"},
  {n:"Cottonwood Cove",lat:35.9990,lng:-114.5000,lvl:14,rarity:"rare"},
  {n:"Los Alamos Lab",lat:35.875,lng:-106.300,lvl:50,rarity:"legendary"},
  {n:"Yucca Mountain",lat:37.000,lng:-116.800,lvl:50,rarity:"legendary"},
  {n:"Nevada Test Site",lat:37.100,lng:-116.000,lvl:48,rarity:"legendary"},
  {n:"Diamond City",lat:42.360,lng:-71.058,lvl:15,rarity:"epic"},
  {n:"Glowing Sea",lat:42.200,lng:-71.400,lvl:50,rarity:"legendary"},
  {n:"Vault 111",lat:42.390,lng:-71.300,lvl:5,rarity:"common"},
  {n:"Megaton",lat:38.863,lng:-77.085,lvl:8,rarity:"rare"},
  {n:"Vault 101",lat:38.948,lng:-77.334,lvl:1,rarity:"common"},
  {n:"Dunwich Building",lat:38.920,lng:-77.220,lvl:40,rarity:"legendary"},
  {n:"The Pitt",lat:40.4406,lng:-79.9959,lvl:40,rarity:"legendary"},
  {n:"Nipton Trading Post",lat:35.46667,lng:-115.27222,lvl:4,rarity:"common"},
  {n:"Boulder City Hotel",lat:35.97750,lng:-114.83639,lvl:6,rarity:"rare"},
  {n:"New Vegas Strip",lat:36.112740,lng:-115.174301,lvl:10,rarity:"epic"},
  {n:"Freeside Market",lat:36.170719,lng:-115.143929,lvl:5,rarity:"common"},
  {n:"Red Rock Canyon",lat:36.13514,lng:-115.4283,lvl:8,rarity:"rare"},
  {n:"Nellis Air Force Base",lat:36.2361,lng:-115.0342,lvl:25,rarity:"epic"},
  {n:"Helios One",lat:35.7580,lng:-114.9530,lvl:13,rarity:"epic"},
  {n:"REPCONN Test Site",lat:36.0360,lng:-115.0880,lvl:12,rarity:"rare"},
  {n:"Broken Hills",lat:39.400,lng:-121.200,lvl:20,rarity:"rare"},
  {n:"Fernald Feed Materials",lat:39.290,lng:-84.680,lvl:40,rarity:"legendary"},
  {n:"Dead Wind Cavern",lat:35.8000,lng:-115.4000,lvl:40,rarity:"legendary",strReq:7},
  {n:"Deathclaw Promontory",lat:36.1000,lng:-114.9000,lvl:45,rarity:"legendary",strReq:8},
  {n:"Quarry Junction",lat:35.9200,lng:-115.1800,lvl:35,rarity:"epic",strReq:6},
  {n:"The Den",lat:37.7749,lng:-122.4194,lvl:14,rarity:"rare"},
  {n:"NCR Capital",lat:36.1699,lng:-115.1398,lvl:30,rarity:"epic"},
  {n:"Pantex Plant",lat:35.3117,lng:-101.5600,lvl:90,rarity:"legendary"},
  {n:"Castle Bravo Crater",lat:11.7000,lng:165.2833,lvl:99,rarity:"legendary"},
  {n:"Bonnie Springs Ranch",lat:36.06007,lng:-115.45027,lvl:7,rarity:"common"},
  {n:"Callville Bay Marina",lat:36.14400,lng:-114.72200,lvl:9,rarity:"common"},
  {n:"Sloan Station",lat:35.94361,lng:-115.21722,lvl:5,rarity:"common"},
  {n:"Jean Airport",lat:35.7677,lng:-115.3245,lvl:6,rarity:"common"},
  {n:"McCarran Airport",lat:36.0801,lng:-115.1522,lvl:8,rarity:"rare"},
  {n:"Old Mormon Fort",lat:36.1694,lng:-115.1305,lvl:6,rarity:"common"},
  {n:"Ultra-Luxe Casino",lat:36.0972,lng:-115.1787,lvl:11,rarity:"epic"},
  {n:"Gomorrah Casino",lat:36.1100,lng:-115.1720,lvl:10,rarity:"epic"},
  {n:"Silver Rush",lat:36.1498,lng:-115.1390,lvl:9,rarity:"rare"},
  {n:"Atomic Wrangler",lat:36.1499,lng:-115.1383,lvl:8,rarity:"rare"},
  {n:"Nelson Ghost Town",lat:35.4189,lng:-114.7133,lvl:9,rarity:"rare"},
  {n:"Rhyolite Ghost Town",lat:36.9033,lng:-116.8283,lvl:11,rarity:"rare"},
  {n:"Mt Charleston",lat:36.2650,lng:-115.6500,lvl:16,rarity:"epic"},
  {n:"Luxor Pyramid",lat:36.0965,lng:-115.1769,lvl:9,rarity:"rare"},
  {n:"Whiskey Pete's",lat:35.6167,lng:-115.3900,lvl:3,rarity:"common"},
  {n:"Primm Valley Resort",lat:35.6160,lng:-115.3900,lvl:3,rarity:"common"},
  {n:"Westgate Hotel",lat:36.1311,lng:-115.1564,lvl:10,rarity:"epic"},
  {n:"Coca Cola Factory",lat:36.1025,lng:-115.1738,lvl:8,rarity:"rare"},
  {n:"Nellis Solar Array",lat:36.2460,lng:-115.0320,lvl:15,rarity:"epic"},
  {n:"Ivanpah Solar",lat:35.2000,lng:-115.4667,lvl:18,rarity:"epic"},
  {n:"Cottonwood Cove",lat:35.9990,lng:-114.5000,lvl:14,rarity:"rare"},
  {n:"Vault 34",lat:36.1750,lng:-114.7500,lvl:20,rads:200},
  {n:"Jacobstown",lat:36.3000,lng:-115.6500,lvl:22,rarity:"rare"},
  {n:"Dead Wind Cavern",lat:35.8000,lng:-115.4000,lvl:25,rads:180},
  {n:"REPCONN Headquarters",lat:36.0500,lng:-115.1000,lvl:13,rads:95},
  {n:"188 Trading Post",lat:35.9500,lng:-115.2000,lvl:8,rads:25},
  {n:"Griffin Caravan",lat:35.9000,lng:-115.2500,lvl:7,rads:20},
  {n:"Nevada Highway Patrol",lat:35.9500,lng:-115.1500,lvl:6,rads:15},
  {n:"Sarsaparilla HQ",lat:36.0000,lng:-115.2000,lvl:10,rads:60},
  {n:"HELIOS One Entrance",lat:35.7600,lng:-114.9500,lvl:13,rads:90},
  {n:"Camp Searchlight",lat:35.4600,lng:-114.9200,lvl:11,rads:130},
  {n:"Quarry Junction",lat:35.9200,lng:-115.1800,lvl:20,rads:70},
  {n:"Vikki Vance Museum",lat:35.6150,lng:-115.3850,lvl:4,rads:18},
  {n:"Mesquite Mountains",lat:35.8500,lng:-115.9500,lvl:17,rads:100},
  {n:"Devil's Gullet",lat:35.7000,lng:-115.3000,lvl:23,rads:150},
  {n:"Primm Schoolhouse",lat:35.6150,lng:-115.3850,lvl:3,rads:12},
  {n:"Nipton Hall",lat:35.4667,lng:-115.2722,lvl:5,rads:50},
  {n:"Boulder City Ruins",lat:35.9775,lng:-114.8364,lvl:7,rads:20},
  {n:"Megaton",lat:38.863,lng:-77.085,lvl:5,rads:20},
  {n:"Jefferson Memorial",lat:38.876,lng:-77.012,lvl:15,rads:80},
  {n:"Raven Rock",lat:39.732,lng:-77.421,lvl:25,rads:120},
  {n:"The Citadel",lat:38.875,lng:-77.018,lvl:20,rads:30},
  {n:"Vault 101",lat:38.948,lng:-77.334,lvl:1,rads:5},
  {n:"Rivet City",lat:38.874,lng:-77.022,lvl:8,rads:25},
  {n:"Point Lookout",lat:38.043,lng:-76.003,lvl:22,rads:200},
  {n:"Dunwich Building",lat:38.920,lng:-77.220,lvl:30,rads:400},
  {n:"Tenpenny Tower",lat:38.920,lng:-77.200,lvl:18,rads:15},
  {n:"Paradise Falls",lat:38.900,lng:-77.250,lvl:12,rads:35},
  {n:"Evergreen Mills",lat:38.850,lng:-77.300,lvl:15,rads:60},
  {n:"Vault 108",lat:38.880,lng:-77.100,lvl:14,rads:90},
  {n:"Little Lamplight",lat:38.820,lng:-77.380,lvl:10,rads:25},
  {n:"Andale",lat:38.900,lng:-77.120,lvl:8,rads:40},
  {n:"Arefu",lat:38.920,lng:-77.180,lvl:6,rads:18},
  {n:"Arlington Cemetery",lat:38.880,lng:-77.070,lvl:20,rads:90},
  {n:"Springvale School",lat:38.910,lng:-77.310,lvl:8,rads:25},
  {n:"Super-Duper Mart",lat:38.920,lng:-77.290,lvl:6,rads:18},
  {n:"Grayditch",lat:38.880,lng:-77.170,lvl:10,rads:40},
  {n:"Minefield",lat:38.860,lng:-77.130,lvl:12,rads:30},
  {n:"Vault 87",lat:38.950,lng:-77.850,lvl:30,rads:300},
  {n:"Old Olney",lat:39.050,lng:-77.150,lvl:22,rads:100},
  {n:"Enclave Camp",lat:39.200,lng:-77.500,lvl:28,rads:120},
  {n:"Mama Dolce's",lat:38.850,lng:-77.200,lvl:15,rads:60},
  {n:"Junction 109",lat:38.840,lng:-77.100,lvl:14,rads:50},
  {n:"Robotics Facility",lat:38.820,lng:-77.080,lvl:16,rads:70},
  {n:"Germantown Police",lat:38.970,lng:-77.170,lvl:18,rads:85},
  {n:"Murder Pass",lat:39.000,lng:-77.200,lvl:20,rads:110},
  {n:"Point Lookout Lighthouse",lat:38.043,lng:-76.003,lvl:25,rads:220},
  {n:"Turtledove Detention Camp",lat:38.100,lng:-76.400,lvl:18,rads:80},
  {n:"The Pitt",lat:40.4406,lng:-79.9959,lvl:40,rads:600},
  {n:"Diamond City",lat:42.360,lng:-71.058,lvl:10,rads:15},
  {n:"Goodneighbor",lat:42.356,lng:-71.061,lvl:12,rads:40},
  {n:"The Institute",lat:42.358,lng:-71.057,lvl:35,rads:10},
  {n:"Glowing Sea",lat:42.200,lng:-71.400,lvl:40,rads:800},
  {n:"Nuka-World",lat:42.300,lng:-72.900,lvl:30,rads:300},
  {n:"Far Harbor",lat:44.300,lng:-68.300,lvl:33,rads:500},
  {n:"Vault 111",lat:42.390,lng:-71.300,lvl:5,rads:20},
  {n:"Sanctuary Hills",lat:42.210,lng:-71.410,lvl:3,rads:8},
  {n:"Concord",lat:42.450,lng:-71.350,lvl:7,rads:12},
  {n:"Bunker Hill",lat:42.370,lng:-71.070,lvl:15,rads:25},
  {n:"Vault 114",lat:42.370,lng:-71.050,lvl:18,rads:60},
  {n:"Boston Common",lat:42.356,lng:-71.065,lvl:20,rads:100},
  {n:"Trinity Plaza",lat:42.360,lng:-71.060,lvl:22,rads:80},
  {n:"Vault 95",lat:42.100,lng:-71.500,lvl:28,rads:200},
  {n:"Spectacle Island",lat:42.350,lng:-70.950,lvl:25,rads:150},
  {n:"Vault 76",lat:39.500,lng:-79.900,lvl:1,rads:10},
  {n:"Whitespring Resort",lat:38.050,lng:-79.800,lvl:25,rads:30},
  {n:"Appalachian Workshop",lat:38.200,lng:-80.000,lvl:12,rads:40},
  {n:"The Crater",lat:37.900,lng:-79.700,lvl:35,rads:150},
  {n:"West Tek",lat:38.300,lng:-80.100,lvl:28,rads:200},
  {n:"Toxic Valley",lat:38.400,lng:-80.200,lvl:22,rads:300},
  {n:"Ash Heap",lat:37.700,lng:-81.100,lvl:18,rads:120},
  {n:"Area 51",lat:37.2431,lng:-115.7930,lvl:45,rads:600},
  {n:"Los Alamos Lab",lat:35.875,lng:-106.300,lvl:50,rads:900},
  {n:"Trinity Site",lat:33.677,lng:-106.475,lvl:55,rads:1200},
  {n:"Chernobyl Pripyat",lat:51.389,lng:30.099,lvl:60,rads:3000},
  {n:"Fukushima Daiichi",lat:37.421,lng:141.032,lvl:65,rads:5000},
  {n:"Three Mile Island",lat:40.1522,lng:-77.1581,lvl:20,rads:150},
  {n:"Hanford Site",lat:46.5494,lng:-119.4762,lvl:40,rads:400},
  {n:"Savannah River",lat:33.247,lng:-81.402,lvl:35,rads:300},
  {n:"Yucca Mountain",lat:37.000,lng:-116.800,lvl:50,rads:1000},
  {n:"Nevada Test Site",lat:37.100,lng:-116.000,lvl:48,rads:800},
  {n:"Windscale",lat:54.417,lng:-3.487,lvl:42,rads:700},
  {n:"Kyshtym",lat:55.767,lng:60.867,lvl:55,rads:2000},
  {n:"Vault 13",lat:37.500,lng:-121.900,lvl:15,rads:25},
  {n:"Shady Sands",lat:34.0522,lng:-118.2437,lvl:8,rads:12},
  {n:"The Hub",lat:34.0522,lng:-118.2437,lvl:12,rads:18},
  {n:"Gecko Reactor",lat:37.8000,lng:-121.9000,lvl:25,rads:150},
  {n:"Vault City",lat:39.7392,lng:-104.9903,lvl:22,rads:40},
  {n:"New Reno",lat:39.5296,lng:-119.8138,lvl:28,rads:35},
  {n:"Redding Mines",lat:40.6066,lng:-122.1488,lvl:20,rads:60},
  {n:"NCR Base",lat:36.1699,lng:-115.1398,lvl:15,rads:20},
  {n:"Brotherhood Bunker",lat:34.0522,lng:-118.2437,lvl:30,rads:50},
  {n:"Klamath",lat:42.0000,lng:-121.8000,lvl:10,rads:15},
  {n:"Modoc",lat:41.6331,lng:-120.0294,lvl:16,rads:30},
  {n:"Ghost Farm",lat:41.5000,lng:-120.0000,lvl:12,rads:20},
  {n:"Vault 15",lat:34.5000,lng:-118.5000,lvl:18,rads:40},
  {n:"Junktown",lat:37.7749,lng:-122.4194,lvl:6,rads:10},
  {n:"The Cathedral",lat:34.0522,lng:-118.2437,lvl:35,rads:100},
  {n:"Military Base",lat:36.0000,lng:-115.0000,lvl:40,rads:120},
  {n:"Glow",lat:35.0000,lng:-115.0000,lvl:55,rads:1000},
  {n:"Mariposa Base",lat:37.5000,lng:-120.5000,lvl:45,rads:300},
  {n:"Sierra Army Depot",lat:40.0000,lng:-120.0000,lvl:38,rads:200},
  {n:"EPA",lat:38.0000,lng:-122.0000,lvl:25,rads:80},
  {n:"The Master Lair",lat:34.0522,lng:-118.2437,lvl:60,rads:500},
  {n:"Children of the Cathedral",lat:34.0522,lng:-118.2437,lvl:32,rads:90},
  {n:"Followers Outpost",lat:36.1699,lng:-115.1398,lvl:12,rads:15},
  {n:"Gun Runners",lat:36.1699,lng:-115.1398,lvl:20,rads:25},
  {n:"Free Economic Zone",lat:36.1699,lng:-115.1398,lvl:18,rads:20},
  {n:"New California Republic",lat:36.1699,lng:-115.1398,lvl:25,rads:30},
  {n:"Shale Bridge",lat:37.7749,lng:-122.4194,lvl:8,rads:12},
  {n:"Sulphur Pits",lat:40.0000,lng:-122.0000,lvl:22,rads:70},
  {n:"Raided Caravan",lat:37.0000,lng:-121.0000,lvl:10,rads:18},
  {n:"Mutant Camp",lat:37.5000,lng:-121.5000,lvl:28,rads:60},
  {n:"Raider Outpost",lat:38.0000,lng:-122.0000,lvl:15,rads:25},
  {n:"Scavenger Camp",lat:39.0000,lng:-123.0000,lvl:12,rads:20},
  {n:"Abandoned Mine",lat:40.0000,lng:-124.0000,lvl:20,rads:50},
  {n:"Super Mutant Base",lat:41.0000,lng:-125.0000,lvl:35,rads:100},
  {n:"Deathclaw Nest",lat:42.0000,lng:-126.0000,lvl:40,rads:150},
  {n:"Radscorpion Den",lat:43.0000,lng:-127.0000,lvl:25,rads:80},
  {n:"Cazador Hive",lat:36.0000,lng:-115.0000,lvl:30,rads:90},
  {n:"Gecko Town",lat:37.8000,lng:-121.9000,lvl:22,rads:150},
  {n:"Vault 8",lat:37.0000,lng:-121.0000,lvl:28,rads:40},
  {n:"Vault 12",lat:37.7749,lng:-122.4194,lvl:35,rads:200},
  {n:"Vault 17",lat:36.1699,lng:-115.1398,lvl:32,rads:120},
  {n:"Enclave Oil Rig",lat:33.000,lng:-118.000,lvl:50,rads:200},
  {n:"Brotherhood HQ",lat:34.0522,lng:-118.2437,lvl:35,rads:60},
  {n:"Raider Stronghold",lat:37.0000,lng:-121.0000,lvl:22,rads:45},
  {n:"Mutant Stronghold",lat:37.5000,lng:-121.5000,lvl:38,rads:120},
  {n:"Deathclaw Promontory",lat:38.0000,lng:-122.0000,lvl:45,rads:180},
  {n:"Oil Rig",lat:33.0000,lng:-118.0000,lvl:55,rads:250},
  {n:"Vault 11",lat:35.5000,lng:-117.0000,lvl:28,rads:90},
  {n:"Vault 22",lat:36.1699,lng:-115.1398,lvl:32,rads:150},
  {n:"Vault 3",lat:36.2000,lng:-115.8000,lvl:25,rads:80},
  {n:"Vault 19",lat:36.1000,lng:-115.9000,lvl:22,rads:60},
  {n:"Vault 21",lat:36.1699,lng:-115.1398,lvl:18,rads:40},
  {n:"Vault 29",lat:36.0000,lng:-116.0000,lvl:30,rads:100},
  {n:"Vault 32",lat:35.8000,lng:-116.2000,lvl:28,rads:90},
  {n:"Vault 36",lat:35.6000,lng:-116.4000,lvl:35,rads:150},
  {n:"Vault 87",lat:38.950,lng:-77.850,lvl:30,rads:300},
  {n:"Vault 92",lat:38.900,lng:-77.300,lvl:25,rads:80},
  {n:"Vault 106",lat:38.800,lng:-77.400,lvl:32,rads:120},
    {n:"Vault 112",lat:38.700,lng:-77.500,lvl:28,rads:100},
  {n:"Mothership Zeta",lat:0,lng:0,lvl:99,rarity:"legendary"}
].map(loc => ({
  ...loc,
  rarity: loc.rarity || (loc.lvl >= 70 ? "legendary" : loc.lvl >= 40 ? "epic" : loc.lvl >= 20 ? "rare" : "common"),
  rads: loc.rads ?? (loc.lvl > 70 ? loc.lvl * 4 : loc.lvl > 40 ? loc.lvl * 3 : loc.lvl > 20 ? loc.lvl * 1.5 : 0)
}));

let player = {
  lat:36.1699,lng:-115.1398,caps:0,hp:100,maxHp:100,rads:0,stimpaks:0,
  lvl:1,statPoints:0,
  special:{S:5,P:5,E:5,C:5,I:5,A:5,L:5},
  perks:[],claimed:[]
};

let map, playerMarker, markers = {}, claimed = new Set();
let currentTab = 'map';

function loadPlayer(){const s=localStorage.getItem('afPlayer');if(s){Object.assign(player,JSON.parse(s)); player.claimed.forEach(c=>claimed.add(c));} updateUI();}
function savePlayer(){localStorage.setItem('afPlayer',JSON.stringify(player));}

function updateUI(){
  document.getElementById('hpText').innerText = `${Math.floor(player.hp)}/${player.maxHp}`;
  document.getElementById('radsText').innerText = Math.floor(player.rads);
  document.getElementById('capsText').innerText = player.caps;
  document.querySelector('#hpBar > div').style.width = (player.hp/player.maxHp*100)+'%';
  document.querySelector('#radsBar > div').style.width = (player.rads/1000*100)+'%';

  if(player.hp<=0||player.rads>=1000){
    alert("YOU DIED IN THE GLOW\nRespawning at Vault 77 entrance...");
    player.hp=player.maxHp; player.rads=0;
  }

  const newLvl = Math.floor(player.caps/1000)+1;
  if(newLvl > player.lvl){
    player.lvl = newLvl;
    player.statPoints += 1;
    player.maxHp += 20;
    player.hp = player.maxHp;
    alert(`LEVEL UP → ${player.lvl} | +1 STAT POINT | MAX HP +20`);
  }
}

function checkRadiation(){
  let totalRads = 0;
  locations.forEach(loc=>{
    if(!loc.rads) return;
    const dist = map.distance([player.lat,player.lng],[loc.lat,loc.lng]);
    if(dist < 800) totalRads += loc.rads * (800/dist);
  });
  const resist = player.special.E / 15;
  player.rads += (totalRads/300) * (1 - resist);
  player.rads = Math.min(1000, player.rads);
  document.getElementById('radVignette').classList.toggle('active', totalRads>50);
  updateUI();
}

setInterval(()=>{ if(player.rads>0) player.hp -= player.rads/800; checkRadiation(); savePlayer(); },4000);

function showTab(tab){
  currentTab=tab;
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  event.target.classList.add('active');
  if(tab==='stats') showStats();
  if(tab==='inv') showInventory();
}

function showInventory(){
  document.getElementById('statsOverlay').innerHTML = `<h2 style="font-size:5rem;margin:20px">INVENTORY</h2>
    <div style="font-size:3rem;line-height:2.5">Stimpaks: ${player.stimpaks}<br>Caps: $${player.caps}<br>Level: ${player.lvl}</div>`;
  document.getElementById('statsOverlay').style.display='flex';
}

function showStats(){
  const names = ['STRENGTH','PERCEPTION','ENDURANCE','CHARISMA','INTELLIGENCE','AGILITY','LUCK'];
  let html = '<h2 style="font-size:5rem">S.P.E.C.I.A.L.</h2>';
  ['S','P','E','C','I','A','L'].forEach((k,i)=>{
    html += `<div class="stat"><span class="stat-name">${names[i]}</span>
      <span class="stat-value">${player.special[k]}</span>
      <button class="plus-btn" onclick="upgradeStat('${k}')">+</button></div>`;
  });
  document.getElementById('statGrid').innerHTML = html;
  document.querySelectorAll('.plus-btn').forEach(b=>b.style.display=player.statPoints>0?'inline-block':'none');

  let perkHtml = '<h3 style="color:#ffff00;margin-top:50px">PERKS (every 3 lvl)</h3>';
  if(player.lvl>=3){
    const perks=[{name:"Rad Resistance",desc:"+3 END total",req:{E:4}},{name:"Bloody Mess",desc:"+25% CAPS",req:{L:6}},{name:"Scrounger",desc:"Double stimpaks",req:{L:7}}];
    perks.forEach(p=>{
      const can = !player.perks.includes(p.name);
      perkHtml += `<div class="perk" style="opacity:${can?1:0.4}" onclick="${can?`takePerk('${p.name}')`:''}">${p.name}<br><small>${p.desc}</small></div>`;
    });
  }
  document.getElementById('perkList').innerHTML = perkHtml;
  document.getElementById('statsOverlay').style.display='flex';
}

function upgradeStat(s){ if(player.statPoints>0){ player.special[s]++; player.statPoints--; savePlayer(); showStats(); } }
function takePerk(n){
  player.perks.push(n);
  if(n==="Rad Resistance") player.special.E+=3;
  savePlayer(); showStats();
}

function claimLoot(loc){
  if(claimed.has(loc.n)){ alert("Already scavenged!"); return; }
  if(loc.strReq && player.special.S < loc.strReq){ alert(`STRENGTH ${loc.strReq} REQUIRED!\n(You have ${player.special.S})`); return; }
  if(player.lvl < loc.lvl){ alert(`LEVEL ${loc.lvl} REQUIRED!`); return; }

  claimed.add(loc.n); player.claimed.push(loc.n);
  const pBonus = 1 + (player.special.P-5)/15;
  const capsGain = Math.floor((loc.lvl*15) * pBonus);
  const stims = player.perks.includes("Scrounger") ? (loc.rarity==='legendary'?10:loc.rarity==='epic'?6:loc.rarity==='rare'?4:2) : (loc.rarity==='legendary'?5:loc.rarity==='epic'?3:loc.rarity==='rare'?2:1);

  player.caps += capsGain;
  player.stimpaks += stims;
  if(loc.rads) player.rads += loc.rads/3;

  document.getElementById('lootMessage').innerHTML = `
    <span style="color:#0ff;font-size:5rem">${loc.n.toUpperCase()}</span><br><br>
    +${capsGain} CAPS<br>
    +${stims} STIMPAK${stims>1?'S':''}<br>
    ${loc.rads ? `<span style="color:#f00">+${Math.floor(loc.rads/3)} RADS TAKEN</span>` : ''}
  `;
  document.getElementById('lootOverlay').style.display='flex';
  markers[loc.n].setStyle({fillColor:'#001100',fillOpacity:0.6});
  savePlayer(); updateUI();
}

async function initMap(){
  loadPlayer();
  map = L.map('map',{zoomControl:false,attributionControl:false}).setView([player.lat,player.lng],16);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:''}).addTo(map);

  playerMarker = L.circleMarker([player.lat,player.lng],{radius:25,color:'#000',weight:8,fillColor:'#00ff00',fillOpacity:1})
    .addTo(map);
  playerMarker.getElement().style.filter = 'drop-shadow(0 0 40px #0f0)';

  locations.forEach(loc=>{
    const color = loc.rads > 200 ? '#ff0044' : loc.rarity==='legendary'?'#ffff00':loc.rarity==='epic'?'#ff6200':loc.rarity==='rare'?'#00ffff':'#00ff00';
    const m = L.circleMarker([loc.lat,loc.lng],{radius:20,color:'#000',weight:7,fillColor:color,fillOpacity:0.95})
      .bindPopup(`<b style="color:#0f0;font-size:1.5rem">${loc.n}</b><br>LVL ${loc.lvl} • ${loc.rarity.toUpperCase()}${loc.strReq?`<br>REQ STR ${loc.strReq}`:''}${loc.rads?`<br>☢ ${loc.rads} RADS`:''}`)
      .on('click',()=>claimLoot(loc))
      .addTo(map);
    markers[loc.n]=m;
    if(claimed.has(loc.n)) m.setStyle({fillColor:'#001100',fillOpacity:0.6});
  });

  if('geolocation' in navigator){
    navigator.geolocation.watchPosition(pos=>{
      player.lat=pos.coords.latitude; player.lng=pos.coords.longitude;
      playerMarker.setLatLng([player.lat,player.lng]);
      map.panTo([player.lat,player.lng]);
    },null,{enableHighAccuracy:true,maximumAge:0,timeout:5000});
  }
}

document.addEventListener('DOMContentLoaded', initMap);
</script>
</body>
</html>